<div class="block justify-center bg-gray-50 p-4">
    <h2 class="text-3xl">Cargue de Planillas de Asistencia</h2>
    <p>Por favor seleccione un archivo de las planillas de asistencia o cargue una fotografía</p>
    <mat-card class="p-6 w-full shadow-lg rounded-lg mb-4">
      <h2 class="text-xl font-semibold text-gray-700 mb-4">Subir Imagen</h2>
  
      <div class="mb-6">
        <!-- Input para subir la imagen -->
         <div class="border border-red-500 border-solid p-4 text-red-500" *ngIf="alert">
            {{ alert }}
         </div>
        <label
          for="imageUpload"
          class="block text-gray-600 font-medium mb-2"
        >Selecciona o captura una imagen:</label>
        <input
          type="file"
          accept="image/*"
          capture="environment"
          id="imageUpload"
          (change)="onFileSelected($event)"
          class="block w-full border rounded-md p-2 text-sm"
        />
      </div>
  
      <!-- Previsualización de la imagen -->
      <div *ngIf="imagePreview" class="mb-6 ">
        <h3 class="text-gray-600 font-medium mb-2">Previsualización:</h3>
        <p>Por favor utiice los botones para garantizar que la imagen se envía horizontal</p>

        <div *ngIf="!imageLoaded" class="mt-4 mb-4 flex gap-4 justify-center">
          <button
            mat-flat-button
            color="primary"
            (click)="rotateLeft()"
            class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded shadow-md"
          >
            Rotar Izquierda
          </button>
          <button *ngIf="!imageLoaded"
            mat-flat-button
            color="primary"
            (click)="rotateRight()"
            class="bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded shadow-md"
          >
            Rotar Derecha
          </button>
        </div>

        <app-image-viewer
        [imageUrl]="imageUrl"></app-image-viewer>

        <div class="flex flex-col flex-auto min-w-0" *ngIf="showTableData" >

          <!-- Main -->
          <div class="flex-auto p-6 sm:p-10">
      
              <!-- CONTENT GOES HERE -->
              <div class="h-400 min-h-400 max-h-400">
      
                  <div class="grid grid-cols-1 xl:grid-cols-1 w-full ">
      
                      <div class="flex items-center justify-between w-full">
                          <div>
                              <h2 class="text-3xl font-semibold tracking-tight leading-8">Asistencias</h2>
                              <div class="font-medium tracking-tight text-secondary">A continuación encontrará la información de las asistencias cargadas.</div>
                          </div>
                      </div>
      
                      <!-- Recent transactions table -->
                      <div class="flex flex-col flex-auto bg-card shadow rounded-2xl overflow-hidden mt-4" >
                          <div class="overflow-x-auto mx-6">
                              Resultados: {{dataSource.data.length}}
                              <table class="w-full bg-transparent" mat-table matSort [dataSource]="dataSource"
                                  [trackBy]="trackByFn" #recordsTable="matSort">
      
                                  <ng-container *ngFor="let column of recordsTableColumns" [matColumnDef]="column">
                                      <th mat-header-cell mat-sort-header *matHeaderCellDef>{{ columns[column] }}</th>
                                      <ng-container *ngIf="!(column == 'actions' || column == 'stateName')">
                                          <td mat-cell *matCellDef="let rowData">
                                              <span class="pr-6 font-medium text-sm text-secondary whitespace-nowrap">
                                                  {{ rowData[column] }}
                                              </span>
                                          </td>
                                      </ng-container>
      
                                      <ng-container>
                                          <td mat-cell *matCellDef="let transaction">
                                              <button mat-icon-button color="primary" [matMenuTriggerFor]="menu">
                                                  <mat-icon>more_vert</mat-icon>
                                              </button>
                                              <mat-menu class="bg-white" #menu="matMenu">
                                                  <button
                                                  mat-menu-item [routerLink]="['/app', 'component-edit', transaction.id]">
                                                  <mat-icon>edit</mat-icon>
                                                      Modificar Componente
                                                  </button>
                                              </mat-menu>
                                          </td>
                                      </ng-container>
      
                                  </ng-container>
      
      
                                  <!-- Footer -->
                                  <ng-container matColumnDef="recordsTableFooter">
                                      <td class="py-6 px-0 border-0" mat-footer-cell *matFooterCellDef colspan="6">
                                      </td>
                                  </ng-container>
      
                                  <tr mat-header-row *matHeaderRowDef="recordsTableColumns"></tr>
                                  <tr class="order-row h-16" mat-row *matRowDef="let row; columns: recordsTableColumns;">
                                  </tr>
                                  <tr class="h-16 border-0" mat-footer-row *matFooterRowDef="['recordsTableFooter']"></tr>
                              </table>
      
                              <mat-paginator [length]="dataSource.data.length" [pageSize]="10" [pageSizeOptions]="[5, 10, 25, 100]"></mat-paginator>
      
                          </div>
                      </div>
                  </div>
      
              </div>
          </div>
      </div>
      
      
        <img
          [src]="imagePreview"
          alt="Previsualización de la imagen"
          class="rounded-md border shadow-md w-full"
        />


        <div *ngIf="imagePreviewResult" class="mt-4 flex justify-center">
          <a target="_blank"
            [href]="imagePreviewResult" 
            download 
            class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded shadow-md flex items-center gap-2"
          >
            <span class="material-icons">file_download</span>
            Descargar Imagen Resultado
          </a>
        </div>
        
      </div>
  
      <!-- Botón para enviar -->
      <button *ngIf="!imageLoaded"
        mat-flat-button
        color="primary"
        class="w-full"
        [disabled]="!imagePreview"
        (click)="uploadImage()"
      >
        Subir Planilla
      </button>
            <!-- Botón para enviar -->
            <button *ngIf="imageLoaded"
            mat-flat-button
            color="primary"
            class="w-full"
            (click)="newAssistance()"
          >
            Subir Otra Planilla
          </button>
    </mat-card>
  </div>


  <app-loading *ngIf="loading"></app-loading>