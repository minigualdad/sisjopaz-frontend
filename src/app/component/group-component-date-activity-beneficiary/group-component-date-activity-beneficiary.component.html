<div class="flex flex-col flex-auto min-w-0 bg-gray-100 h-screen">
  <div class="flex-auto p-4 sm:p-10 overflow-auto">
    <div class="w-full">
      <div class="w-full flex sm:items-center justify-start mb-2 flex-col sm:flex-row">
        <app-button-back [routeBack]="backRoute" class="mb-2"></app-button-back>
      <h2 class="text-2xl sm:text-3xl font-semibold tracking-tight leading-8">
        Actividad del Grupo: {{groupComponent.group}} <br> Componente: {{groupComponent.component}}
      </h2>
      </div>
      <div class="font-medium tracking-tight text-secondary mb-4">
        A continuación encontrará la información general de la actividad del grupo.
        <button (click)="create()"
          class="bg-primary m-4 rounded-2xl inline-flex items-center justify-center px-3 py-2 sm:px-4 sm:py-2 text-white font-bold"
          mat-flat-button primary (click)="showAddPeriod = true">
          <mat-icon class="icon-size-5 text-white">add</mat-icon>
          <span class="ml-2">Asignar Actividad</span>
        </button>
      </div>
      <app-survey-finder (surveyListen)="onSelectSurvey($event)"></app-survey-finder>


      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-end gap-2 sm:gap-4 mt-4">

      </div>
    </div>

    <div class="flex flex-col flex-auto bg-card shadow rounded-2xl overflow-hidden mt-4 h-auto">
      <div class="overflow-x-auto p-4">
        <!-- <mat-form-field class="bg-white rounded-md w-full mt-4">
          <mat-label>Buscar en todos los campos</mat-label>
          <input matInput (keyup)="applyFilter($event)" placeholder="Buscar"
            class="py-2 px-3 rounded-md shadow-sm text-gray-700 leading-5 focus:outline-none focus:shadow-outline-blue focus:border-blue-300">
        </mat-form-field> -->

        <div class="flex justify-between items-center w-full h-16">
          <div class="mt-2 mb-2 text-sm text-gray-700">Resultados: {{totalSize}}</div>

          <button [disabled]="selectedIds.length === 0" (click)="removeIds()"
          class="h-10 rounded-2xl px-2 flex text-center items-center justify-around py-6 text-white cursor-pointer
            bg-pink-500 hover:bg-pink-700 disabled:bg-gray-400 disabled:cursor-not-allowed">
          <mat-icon class="icon-size-5 text-white">delete</mat-icon>
          Borrar Selección
        </button>
        

        </div>

        <table class="w-full" mat-table matSort [dataSource]="dataSource" [trackBy]="trackByFn"
       #recordsTable="matSort">

        <!-- Columna de selección (Checkbox) -->
        <ng-container matColumnDef="select">
          <th mat-header-cell *matHeaderCellDef>
            <mat-checkbox (change)="toggleSelectAll($event)"></mat-checkbox>
          </th>
          <td mat-cell *matCellDef="let rowData">
            <mat-checkbox [checked]="selectedIds.includes(rowData.id)" 
                          (change)="toggleSelection(rowData.id)">
            </mat-checkbox>
          </td>
        </ng-container>

        <!-- Iteración de columnas sin incluir 'select' -->
        <ng-container *ngFor="let column of recordsTableColumns" [matColumnDef]="column">
          <th mat-header-cell mat-sort-header *matHeaderCellDef>{{ columns[column] }}</th>

          <td mat-cell *matCellDef="let rowData" class="whitespace-nowrap py-2 px-3">
            <span class="font-medium text-sm text-secondary">{{ rowData[column] }}</span>
          </td>
        </ng-container>

        <!-- Columna de acciones -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Acciones</th>
          <td mat-cell *matCellDef="let transaction">
            <button mat-icon-button color="primary" [matMenuTriggerFor]="menu">
              <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu class="bg-white" #menu="matMenu">
              <button mat-menu-item (click)="remove(transaction.id)">
                <mat-icon>delete</mat-icon>
                Eliminar registro
              </button>
              <button mat-menu-item (click)="show(transaction, 'original')" *ngIf="transaction?.hasAssitence">
                <mat-icon>visibility</mat-icon>
                Ver Planillas Originales
              </button>
              <button mat-menu-item (click)="show(transaction, 'process')" *ngIf="transaction?.hasAssitence">
                <mat-icon>visibility</mat-icon>
                Ver Planillas Procesadas
              </button>
            </mat-menu>
          </td>
        </ng-container>

        <!-- Definir las filas usando displayedColumns -->
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" 
            [ngClass]="getRowBorderColor(row.hasAssitence)">
        </tr>    

      </table>

        <div class="mt-4">
          <mat-paginator #paginator [length]="dataSource.data.length" [pageSize]="10"
            [pageSizeOptions]="[5, 10, 25, 100]" (page)="onPageChange($event)"></mat-paginator>
        </div>
      </div>
    </div>
  </div>
</div>
<app-loading *ngIf="loading"></app-loading>
<app-group-component-date-activity-beneficiary-add *ngIf="isFormVisible" (modal)="reciveEvent($event)">

</app-group-component-date-activity-beneficiary-add>

<div *ngIf="isModalOpen" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
  <div class="bg-white rounded-lg shadow-lg w-full max-w-4xl max-h-[90vh] overflow-y-auto p-6">
    <!-- Encabezado del modal -->
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-bold">Imagenes Planillas</h2>
      <button (click)="isModalOpen = false" class="text-gray-500 hover:text-gray-700">
        ✕
      </button>
    </div>

    <div class="mb-8" *ngIf="typeImage == 'original'">
      <h3 class="text-lg font-semibold mb-2">Imágenes Originales</h3>
      <div class="grid grid-cols-1 gap-4">
        <div *ngFor="let img of originalImages" class="border rounded-lg p-2">
          <img [src]="img" alt="Original" class="w-full h-auto object-contain max-h-60">
        </div>
      </div>
    </div>

    <!-- Imágenes Procesadas -->
    <div class="mb-8" *ngIf="typeImage == 'process'">
      <h3 class="text-lg font-semibold mb-2">Imágenes Procesadas</h3>
      <div class="grid grid-cols-1 gap-4">
        <div *ngFor="let img of processedImages" class="border rounded-lg p-2">
          <img [src]="img" alt="Procesada" class="w-full h-auto object-contain max-h-60">
        </div>
      </div>
    </div>
  </div>
</div>
